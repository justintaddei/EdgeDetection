!function(){"use strict";function t(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function e(t,e,n,a){return new(n||(n=Promise))(function(r,i){function o(t){try{l(a.next(t))}catch(t){i(t)}}function c(t){try{l(a.throw(t))}catch(t){i(t)}}function l(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,c)}l((a=a.apply(t,e||[])).next())})}function n(t,e){function n(t){return function(e){return a([t,e])}}function a(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,i=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(t){n=[6,t],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,o,c,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c}var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},r=function(){function t(){var t=this,e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(n){return t[n]=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return e[n].apply(e,t)}})}return t}(),i=function(e){function n(t){var n=e.call(this)||this;return n.targetElement=t,n.targetElement.addEventListener("dragover",function(t){t.preventDefault(),n.targetElement.classList.add("drag-target")},!1),n.targetElement.addEventListener("dragleave",function(){n.targetElement.classList.remove("drag-target")},!1),n.targetElement.addEventListener("drop",function(t){if(t.preventDefault(),t.stopPropagation(),n.targetElement.classList.remove("drag-target"),!t.dataTransfer.files[0]||-1===t.dataTransfer.files[0].type.indexOf("image"))return console.log(t.dataTransfer.files[0]?"Uknown file type: "+t.dataTransfer.files[0].type:"No file to load"),!1;n.lastObjectURL&&URL.revokeObjectURL(n.lastObjectURL),n.lastObjectURL=URL.createObjectURL(t.dataTransfer.files[0]);var e=new CustomEvent("file-ready",{detail:n.lastObjectURL});n.dispatchEvent(e)},!1),n}return t(n,e),n}(r),o=function(){function t(t){this.canvasElement=t,this.context=this.canvasElement.getContext("2d"),this.width=this.canvasElement.width,this.height=this.canvasElement.height}return t.getPixel=function(t,e,n){return t.data[4*t.width*n+4*e]||0},t.setPixel=function(t,e,n,a){t.data[4*t.width*n+4*e]=a,t.data[4*t.width*n+4*e+1]=a,t.data[4*t.width*n+4*e+2]=a,t.data[4*t.width*n+4*e+3]=255},t.toMono=function(t){for(var e=0,n=t.data.length;e<n;e+=4){var a=.3*t.data[e]+.59*t.data[e+1]+.11*t.data[e+2];t.data[e]=a,t.data[e+1]=a,t.data[e+2]=a}},t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.prototype.fillImage=function(t){var e=this;return new Promise(function(n){var a=new Image;a.addEventListener("load",function(){var t=a.naturalWidth,r=a.naturalHeight;t>r?(t=e.width,r=e.height*a.naturalHeight/a.naturalWidth):(r=e.height,t=e.width*a.naturalWidth/a.naturalHeight),e.context.drawImage(a,(e.width-t)/2,(e.height-r)/2,t,r),n()}),a.src=t})},t.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},t.prototype.putImageData=function(t){this.context.putImageData(t,0,0)},t.prototype.applyKernel=function(e,n){t.toMono(e);for(var a=this.context.createImageData(this.width,this.height),r=0;r<e.width;r++)for(var i=0;i<e.height;i++){for(var o=0,c=0;c<n.length;c++)for(var l=0;l<n[c].length;l++){var s=n[c][l],u=t.getPixel(e,r+(l-(n[c].length-1)/2),i+(c-(n.length-1)/2));o+=s*u}t.setPixel(a,r,i,o)}this.putImageData(a)},t}(),c=document.getElementById("rawCanvas"),l=document.getElementById("previewCanvas"),s=new o(c),u=new o(l);new i(c).addEventListener("file-ready",function(t){return e(void 0,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return s.clear(),[4,s.fillImage(t.detail)];case 1:return e.sent(),u.applyKernel(s.getImageData(),[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]]),[2]}})})})}();